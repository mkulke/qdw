     1                                  ; boot.asm â€” 512-byte boot sector that loads stage2 using INT 13h LBA extensions
     2                                  BITS 16
     3                                  ORG 0x7C00
     4                                  
     5                                  STAGE2_LBA equ 1
     6                                  STAGE2_SECTORS equ 1024
     7                                  
     8                                  start:
     9 00000000 FA                          cli
    10 00000001 31C0                        xor ax, ax
    11 00000003 8ED8                        mov ds, ax
    12 00000005 8EC0                        mov es, ax
    13 00000007 8ED0                        mov ss, ax
    14 00000009 BC007C                      mov sp, 0x7C00
    15                                  
    16                                      ; Preserve boot drive from DL (BIOS passes it in DL)
    17 0000000C 8816[5400]                  mov [boot_drive], dl
    18                                  
    19                                      ; Enable A20 (fast A20 gate)
    20 00000010 E492                        in  al, 0x92
    21 00000012 0C02                        or  al, 0x02
    22 00000014 E692                        out 0x92, al
    23                                  
    24                                      ; Check for INT 13h extensions (EDD)
    25 00000016 8A16[5400]                  mov dl, [boot_drive]
    26 0000001A B441                        mov ah, 0x41
    27 0000001C BBAA55                      mov bx, 0x55AA
    28 0000001F CD13                        int 0x13
    29 00000021 721C                        jc  disk_error        ; Extensions not supported
    30 00000023 81FB55AA                    cmp bx, 0xAA55
    31 00000027 7516                        jne disk_error
    32                                  
    33                                      ; Load stage2 using LBA mode (INT 13h, AH=42h)
    34 00000029 8A16[5400]                  mov dl, [boot_drive]
    35 0000002D B442                        mov ah, 0x42
    36 0000002F BE[4400]                    mov si, dap
    37 00000032 CD13                        int 0x13
    38 00000034 7209                        jc  disk_error
    39                                  
    40                                      ; Jump to stage2 with boot drive in DL
    41 00000036 8A16[5400]                  mov dl, [boot_drive]
    42 0000003A EA00800000                  jmp 0x0000:0x8000
    43                                  
    44                                  disk_error:
    45 0000003F F4                          hlt
    46 00000040 EBFD                        jmp disk_error
    47                                  
    48                                  ; Disk Address Packet (DAP) for INT 13h AH=42h
    49 00000042 90<rep 2h>              align 4
    50                                  dap:
    51 00000044 10                          db 0x10               ; size of DAP (16 bytes)
    52 00000045 00                          db 0                  ; reserved (must be 0)
    53 00000046 0004                        dw STAGE2_SECTORS     ; number of sectors to read
    54 00000048 0080                        dw 0x8000             ; offset (0x8000)
    55 0000004A 0000                        dw 0x0000             ; segment (0x0000)
    56 0000004C 0100000000000000            dq STAGE2_LBA         ; starting LBA (sector 1)
    57                                  
    58 00000054 00                      boot_drive: db 0
    59                                  
    60 00000055 00<rep 1A9h>            times 510-($-$$) db 0
    61 000001FE 55AA                    dw 0xAA55
